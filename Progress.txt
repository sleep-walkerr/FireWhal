For Next Meeting: 10/31/2025

· Build the UI to integrate all the components

· Access control to the firewall rule file (consider later; consider read, read/write permissions on this file)

· Fixing the stateful firewall

· Adding control of the apps by your firewall

· Adding the integrity check for the files
    

Progress Made:
-- 

Permissive mode, user has interface open, runs the app they want to let through, the list populates with lineage entries for every application that attempted a connection and the user selects which applications they want to add 
Hash Management Interface, gives the user a list of all registered applications. A button is next to each application giving the user the option to rehash the application and allow it again, and there is a button to rehash all applications.
Hash is red if invalid, and green if valid.

This is AI's response to my plan about revising how TGID is checked and acquired in tc_egress, I'm putting this here so I don't need to go back to my chat to get a clue 

Revised PENDING_CONNECTIONS_MAP Strategy (Crucial Refinement):
Instead of Map<ConnectionKey, TGID>:

PENDING_CONNECTIONS_MAP: Map<ConnectionKey, TGID> (temp storage for TGID during initial pending phase)

TRUSTED_CONNECTIONS_MAP: Map<ConnectionKey, u8> (stores "is this connection allowed?" for approved connections)

TRUSTED_PIDS_MAP: Map<TGID, u8> (stores "is this PID generally allowed?")

Flow with these 3 maps:

cgroup/connect4:

Extract ConnectionKey & TGID.

Insert (ConnectionKey, TGID) into PENDING_CONNECTIONS_MAP.

Send event to userspace.

Return BPF_OK.

tc_egress:

Extract ConnectionKey from sk_buff.

Attempt Lookup in TRUSTED_CONNECTIONS_MAP:

If ConnectionKey is found and marked "allowed": return TC_ACT_OK. (This handles already-approved connections)

Else, Attempt Lookup in PENDING_CONNECTIONS_MAP:

If ConnectionKey is found, get TGID.

Lookup TGID in TRUSTED_PIDS_MAP.

If TGID found and trusted: return TC_ACT_OK.

If TGID found but NOT trusted: return TC_ACT_SHOT.

If ConnectionKey is NOT found in PENDING_CONNECTIONS_MAP: Apply default untracked policy (TC_ACT_OK or TC_ACT_SHOT).

Userspace Daemon:

Receives ConnectionAttempt (TGID, ConnectionKey).

Verifies TGID.

If TGID is approved:

Insert (TGID, 1) into TRUSTED_PIDS_MAP.

Insert (ConnectionKey, 1) into TRUSTED_CONNECTIONS_MAP.

Delete ConnectionKey from PENDING_CONNECTIONS_MAP.

This refined approach is more robust because tc_egress first checks for already trusted connections (which are the most common case after an initial approval), then falls back to the pending queue for new, unverified ones. This prevents constant double lookups for established traffic.